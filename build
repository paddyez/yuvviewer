#!/bin/bash
cwd="${PWD}/"
flags=(-shared -std=c17 -Wall -Wextra -pedantic -O3 -Wconversion -DNDEBUG -flto -lm)
gui="src/org/yuvViewer/gui/"
include="/include/"
jdk="java-14-openjdk-amd64"
jvm="/usr/lib/jvm/"
linux="linux/"
utils="src/org/yuvViewer/utils/"
options=(${flags[@]} -I${jvm}${jdk}${include} -I${jvm}${jdk}${include}${linux} -o libcalc.so)
if type ant >/dev/null 2>&1
then
	ant
else
	echo 'Apache Ant is not installed. Make shure ant exists is in your path and is executable'
	echo 'Installing Apache Ant http://ant.apache.org/manual/install.html'
fi
#javap -s -p YUVViewer
if type javac >/dev/null 2>&1
then
	javac -h "${gui}" "${gui}FrameAboutBox.java" \
	"${gui}MainFrame.java" \
	"${gui}SettingsDialog.java" \
	"${gui}YUVViewer.java" \
	"${utils}YUVDeclaration.java" \
	"${utils}ExtensionFileFilter.java" \
	"${utils}ExtensionUtils.java"  \
	"${utils}WholeNumberTextField.java"
else
	echo 'javac is not installed'
fi
	cd "${gui}"
if type clang >/dev/null 2>&1
then
  echo 'Compiling using clang'
	clang "${options[@]}" YUVViewerImplementation.c > "${cwd}logfile.log" 2>&1
	sudo mv libcalc.so /usr/local/lib/
elif type gcc >/dev/null 2>&1
then
  echo 'Compiling using gcc'
	gcc "${options[@]}" YUVViewerImplementation.c > "${cwd}logfile.log" 2>&1
	sudo mv libcalc.so /usr/local/lib/
else
	echo 'clang or gcc is not installed'
fi
if type java >/dev/null 2>&1
then
	java -cp "${cwd}src/:." org.yuvViewer.Main
else
	echo 'java is not installed'
fi
